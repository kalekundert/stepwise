[[test_renumber_footnotes]]
new_ids = 1
steps_before = []
steps_after  = []
footnotes_before = {}
footnotes_after  = {}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[1]']
steps_after  = ['[1]']
footnotes_before = {1 = 'Footnote 1'}
footnotes_after  = {1 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = 2
steps_before = ['[1]']
steps_after  = ['[2]']
footnotes_before = {1 = 'Footnote 1'}
footnotes_after  = {2 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[2]']
steps_after  = ['[1]']
footnotes_before = {2 = 'Footnote 1'}
footnotes_after  = {1 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = 2
steps_before = ['[2]']
steps_after  = ['[2]']
footnotes_before = {2 = 'Footnote 1'}
footnotes_after  = {2 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[1] [3]']
steps_after  = ['[1] [2]']
footnotes_before = {1 = 'Footnote 1', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 2
steps_before = ['[1] [3]']
steps_after  = ['[2] [3]']
footnotes_before = {1 = 'Footnote 1', 3 = 'Footnote 3'}
footnotes_after  = {2 = 'Footnote 1', 3 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 3
steps_before = ['[1] [3]']
steps_after  = ['[3] [4]']
footnotes_before = {1 = 'Footnote 1', 3 = 'Footnote 3'}
footnotes_after  = {3 = 'Footnote 1', 4 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[2] [3]']
steps_after  = ['[1] [2]']
footnotes_before = {2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 2', 2 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[3] [1]']
steps_after  = ['[2] [1]']
footnotes_before = {1 = 'Footnote 1', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[1,2]']
steps_after  = ['[1,2]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = 2
steps_before = ['[1,2]']
steps_after  = ['[2,3]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {2 = 'Footnote 1', 3 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[1-3]']
steps_after  = ['[1-3]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 2
steps_before = ['[1-3]']
steps_after  = ['[2-4]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {2 = 'Footnote 1', 3 = 'Footnote 2', 4 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 1
steps_before = ['[1,2,3]']
steps_after  = ['[1-3]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = {1 = 1}
steps_before = ['[1]']
steps_after  = ['[1]']
footnotes_before = {1 = 'Footnote 1'}
footnotes_after  = {1 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = {1 = 2}
steps_before = ['[1]']
steps_after  = ['[2]']
footnotes_before = {1 = 'Footnote 1'}
footnotes_after  = {2 = 'Footnote 1'}

[[test_renumber_footnotes]]
new_ids = {1 = 1, 2 = 2}
steps_before = ['[1] [2]']
steps_after  = ['[1] [2]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {1 = 'Footnote 1', 2 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = {1 = 2, 2 = 1}
steps_before = ['[1] [2]']
steps_after  = ['[2] [1]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {2 = 'Footnote 1', 1 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = 'lambda x: x'
steps_before = ['[2]']
steps_after  = ['[2]']
footnotes_before = {2 = 'Footnote 2'}
footnotes_after  = {2 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = 'lambda x: x-1'
steps_before = ['[2]']
steps_after  = ['[1]']
footnotes_before = {2 = 'Footnote 2'}
footnotes_after  = {1 = 'Footnote 2'}

[[test_renumber_footnotes]]
new_ids = 'lambda x: x'
steps_before = ['[2] [3]']
steps_after  = ['[2] [3]']
footnotes_before = {2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {2 = 'Footnote 2', 3 = 'Footnote 3'}

[[test_renumber_footnotes]]
new_ids = 'lambda x: x-1'
steps_before = ['[2] [3]']
steps_after  = ['[1] [2]']
footnotes_before = {2 = 'Footnote 2', 3 = 'Footnote 3'}
footnotes_after  = {1 = 'Footnote 2', 2 = 'Footnote 3'}

[[test_prune_footnotes]]
steps_before = []
steps_after  = []
footnotes_before = {}
footnotes_after  = {}

[[test_prune_footnotes]]
steps_before = ['[1]']
steps_after  = ['[1]']
footnotes_before = {1 = 'Footnote 1'}
footnotes_after  = {1 = 'Footnote 1'}

[[test_prune_footnotes]]
steps_before = ['[1]']
steps_after  = ['[1]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {1 = 'Footnote 1'}

[[test_prune_footnotes]]
steps_before = ['[2]']
steps_after  = ['[1]']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}
footnotes_after  = {1 = 'Footnote 2'}

[[test_clear_footnotes]]
steps_before = []
steps_after  = []
footnotes_before = {}

[[test_clear_footnotes]]
steps_before = ['Step [1]:']
steps_after  = ['Step:']
footnotes_before = {1 = 'Footnote 1'}

[[test_clear_footnotes]]
steps_before = ['Step [1,2]:']
steps_after  = ['Step:']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2'}

[[test_clear_footnotes]]
steps_before = ['Step [1-3]:']
steps_after  = ['Step:']
footnotes_before = {1 = 'Footnote 1', 2 = 'Footnote 2', 3 = 'Footnote 3'}

[[test_clear_footnotes]]
steps_before = ['Some [1] idea.']
steps_after  = ['Some idea.']
footnotes_before = {1 = 'Footnote 1'}

[[test_pick_slug]]
date = false
commands = []
expected = 'protocol'

[[test_pick_slug]]
date = false
commands = ['command1 args']
expected = 'command1'

[[test_pick_slug]]
date = false
commands = ['file1.txt']
expected = 'file1'

[[test_pick_slug]]
date = false
commands = ['command1 args', 'file2.txt']
expected = 'command1_file2'

[[test_pick_slug]]
date = 1988-11-08
commands = []
expected = '19881108'

[[test_pick_slug]]
date = 1988-11-08
commands = ['command1 args']
expected = '19881108_command1'

[[test_pick_slug]]
date = 1988-11-08
commands = ['file1.txt']
expected = '19881108_file1'

[[test_pick_slug]]
date = 1988-11-08
commands = ['command1 args', 'file2.txt']
expected = '19881108_command1_file2'

[[test_show_date]]
date = '1988-11-08'
expected = "November 8, 1988"

[[test_show_commands]]
commands = ['sw cmd-1']
expected = "$ sw cmd-1"

[[test_show_commands]]
commands = ['sw cmd-1', 'sw cmd-2']
expected = """
$ sw cmd-1
$ sw cmd-2
"""

[[test_show_steps]]
steps = ["Step 1"]
expected = """
1. Step 1
"""

[[test_show_steps]]
steps = ["Step 1\nLine wrap"]
expected = """
1. Step 1
   Line wrap
"""

[[test_show_steps]]
steps = ["Step 1\nLine wrap", "Step 2\nAnother line wrap"]
expected = """
1. Step 1
   Line wrap

2. Step 2
   Another line wrap
"""

[[test_show_steps]]
id = 'leading-whitespace'
steps = ["A\nB", "C\nD", "E\nF", "G\nH", "I\nJ", "K\nL", "M\nN", "O\nP", "Q\nR", "S\nT", "U\nV", "W\nX", "Y\nZ"]
expected = """
 1. A
    B

 2. C
    D

 3. E
    F

 4. G
    H

 5. I
    J

 6. K
    L

 7. M
    N

 8. O
    P

 9. Q
    R

10. S
    T

11. U
    V

12. W
    X

13. Y
    Z
"""

[[test_show_footnotes]]
footnotes = {1 = "Footnote 1"}
expected = """
Note:
[1] Footnote 1
"""

[[test_show_footnotes]]
footnotes = {1 = "Footnote 1", 2 = "Footnote 2"}
expected = """
Notes:
[1] Footnote 1

[2] Footnote 2
"""

[[test_show_footnotes]]
footnotes = {1 = "Footnote 1\nLine wrap"}
expected = """
Note:
[1] Footnote 1
    Line wrap
"""

[[test_show_footnotes]]
footnotes = {1 = "Footnote 1\nLine wrap", 2 = "Footnote 2\nAnother line wrap"}
expected = """
Notes:
[1] Footnote 1
    Line wrap

[2] Footnote 2
    Another line wrap
"""

[[test_show_footnotes]]
footnotes = {1 = "Footnote 1\nLine wrap", 10 = "Footnote 10\nAnother line wrap"}
expected = """
Notes:
 [1] Footnote 1
     Line wrap

[10] Footnote 10
     Another line wrap
"""

[[test_parse_empty]]
text = ""

[[test_parse_empty]]
text = "\n"

[[test_parse_empty]]
text = "\n\n"

[[test_parse_empty]]
text = """

# Comment

"""

[[test_parse_date]]
text = """
November 8, 1988
"""
date = 1988-11-08

[[test_parse_date]]
text = """

November 8, 1988
"""
date = 1988-11-08

[[test_parse_date]]
text = """
November 8, 1988

"""
date = 1988-11-08

[[test_parse_commands]]
text = """
$ sw pcr
"""
commands = ['sw pcr']

[[test_parse_commands]]
text = """

$ sw pcr
"""
commands = ['sw pcr']

[[test_parse_commands]]
text = """
$ sw pcr

"""
commands = ['sw pcr']

[[test_parse_commands]]
text = """
$ sw pcr
$ sw kld
"""
commands = ['sw pcr', 'sw kld']

[[test_parse_commands]]
text = """
$ sw pcr

$ sw kld
"""
commands = ['sw pcr', 'sw kld']

[[test_parse_commands_err]]
text = """
$ sw pcr
unexpected text
"""
err = "expected a step"

[[test_parse_steps]]
text = """
- Step 1
"""
steps = ['Step 1']

[[test_parse_steps]]
text = """

- Step 1
"""
steps = ['Step 1']

[[test_parse_steps]]
text = """
- Step 1

"""
steps = ['Step 1']

[[test_parse_steps]]
text = """
- Step 1
  Line wrap
"""
steps = ["Step 1\nLine wrap"]

[[test_parse_steps]]
text = """
- Step 1

  Blank line
"""
steps = ["Step 1\n\nBlank line"]

[[test_parse_steps]]
text = """
- Step 1
    Indented line
"""
steps = ["Step 1\n  Indented line"]

[[test_parse_steps]]
text = """
- Step 1
  - Substep 1
"""
steps = ["Step 1\n- Substep 1"]

[[test_parse_steps]]
text = """
- Step 1
- Step 2
"""
steps = ['Step 1', 'Step 2']

[[test_parse_steps]]
text = """
- Step 1

- Step 2
"""
steps = ['Step 1', 'Step 2']

[[test_parse_steps]]
text = """
1. Step 1
"""
steps = ['Step 1']

[[test_parse_steps]]
text = """
1. Step 1
2. Step 2
"""
steps = ['Step 1', 'Step 2']

[[test_parse_steps]]
text = """
 1. Step 1
 2. Step 2
"""
steps = ['Step 1', 'Step 2']

[[test_parse_steps_err]]
text = """
- Step 1
unexpected text
"""
err = "expected a step"

[[test_parse_steps_err]]
text = """
  Fake line wrap
"""
err = "expected a step"

[[test_parse_footnotes]]
text = """
Notes:
"""
footnotes = {}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1
"""
footnotes = {1 = 'Footnote 1'}

[[test_parse_footnotes]]
text = """
Notes:

[1] Footnote 1
"""
footnotes = {1 = 'Footnote 1'}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1

"""
footnotes = {1 = "Footnote 1"}

[[test_parse_footnotes]]
id = 'line-wrap'
text = """
Notes:
[1] Footnote 1
    Line wrap
"""
footnotes = {1 = "Footnote 1\nLine wrap"}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1
      Indented line
"""
footnotes = {1 = "Footnote 1\n  Indented line"}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1

    Blank line
"""
footnotes = {1 = "Footnote 1\n\nBlank line"}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1
[2] Footnote 2
"""
footnotes = {1 = "Footnote 1", 2 = "Footnote 2"}

[[test_parse_footnotes]]
text = """
Notes:
[1] Footnote 1

[2] Footnote 2
"""
footnotes = {1 = "Footnote 1", 2 = "Footnote 2"}

[[test_parse_footnotes]]
text = """
Notes:
 [1] Footnote 1
"""
footnotes = {1 = 'Footnote 1'}

[[test_parse_footnotes_err]]
text = """
Notes:
unexpected text
"""
err = "expected a footnote"

[[test_parse_footnotes_err]]
text = """
Notes:
[1] Footnote 1
unexpected text
"""
err = "expected a footnote"

[[test_parse_footnotes_err]]
text = """
Notes:
[1,2] Footnote 1
"""
err = "expected a footnote"

[[test_parse_footnotes_err]]
text = """
Notes:
   Fake line wrap
"""
err = "expected a footnote"

[[test_parse_footnotes_err]]
text = """
- Step 1 [1]
"""
err = 'unknown footnote \[1\]'

[[test_parse_footnotes_err]]
text = """
- Step 1 [2]

Footnotes:
[1] Footnote
"""
err = 'unknown footnote \[2\]'

[[test_parse_footnotes_err]]
text = """
- Step 1 [1,2]

Footnotes:
[1] Footnote
"""
err = 'unknown footnote \[2\]'

[[test_parse_footnotes_err]]
text = """
- Step 1 [1-3]

Footnotes:
[1] Footnote
"""
err = 'unknown footnotes \[2,3\]'
